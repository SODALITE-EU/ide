<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Content-Language" content="en-us">
	<title>AADM Web Editor</title>
	<link rel="stylesheet" type="text/css" href="xtext/2.25.0/xtext-ace.css"/>
	<link rel="stylesheet" type="text/css" href="style.css"/>
	<script src="webjars/requirejs/2.3.6/require.min.js"></script>
	<script type="text/javascript">
		var baseUrl = window.location.pathname;
		var fileIndex = baseUrl.indexOf("index.html");
		if (fileIndex > 0)
			baseUrl = baseUrl.slice(0, fileIndex);
		require.config({
			baseUrl: baseUrl,
			paths: {
				"jquery": "webjars/jquery/3.5.1/jquery.min",
				"ace/ext/language_tools": "webjars/ace/1.3.3/src/ext-language_tools",
				"xtext/xtext-ace": "js/xtext-ace"
			}
		});
		require(["webjars/ace/1.3.3/src/ace"], function() {
			require(["xtext/xtext-ace"], function(xtext) {
				var editor = xtext.createEditor({
					baseUrl: baseUrl,
					syntaxDefinition: "xtext-resources/generated/mode-aadm2",
				});
				$("#save-button").click(function() {
					editor.xtextServices.saveResource();
				});
				$("#revert-button").click(function() {
					editor.xtextServices.revertResource();
				});
				$("#generate-button").click(function() {
					window.open('http://' + location.host + baseUrl + 'xtext-service/generate?resource=' + editor.xtextServices.options.resourceId);
				});
				$("#change-resource").change(function() {
					var resourceId = $("#change-resource option:selected").attr("value");
					editor.xtextServices.serviceBuilder.changeResource(resourceId);
				});
				$('#show').on('click', function () {
					//TODO Add input elements to deployment form
					//Read model, parse inputs
					populate_inputs();
				    $('.center').show();
				})

				$('#close').on('click', function () {
				    $('.center').hide();
				})
			});
		});
		
		function populate_inputs() {
			var inputs = document.querySelector('div[id="inputs"]');
			if (inputs != null && inputs.childElementCount == 0){
				let input_label = document.createTextNode("Input 1");
				let input_text = document.createElement("input1");
				input_text.setAttribute('type', 'text');
				input_text.setAttribute('name', "input1");
				input_text.setAttribute('value', "");
				inputs.appendChild(input_label);
				inputs.appendChild(input_text);		
			}
		}
		
		function increase_worker() {
			var workers = document.querySelector('input[name="workers"]');
			workers.value = String(parseInt(workers.value) + 1)
		}
		
		function decrease_worker() {
			var workers = document.querySelector('input[name="workers"]');
			if (parseInt(workers.value) > 1)
				workers.value = String(parseInt(workers.value) - 1)
		}

	</script>
</head>
<body>
	<div class="header"><b>SODALITE IDE</b></div>
	<div class="header-editor">AADM Editor</div>
	<div class="container-buttons">
		<button id="save-button">Save AADM in KB</button>
		<button id="revert-button">Deploy AADM</button>
		<button id="generate-button">Generate TTL</button>
		<select id="change-resource">
			<option value="snow.aadm">Snow AADM</option>
			<option value="test.aadm">Test AADM</option>
		</select>
		<button id="show">Show form</button>
	</div>
	<div class="container-editor">
		<div id="xtext-editor" 
			data-editor-xtext-lang="aadm"
			data-editor-resource-id="snow.aadm"
			data-editor-dirty-element="dirty-indicator"
			data-editor-enable-save-action="true"
			data-editor-enable-formatting-action="true"
			data-editor-show-error-dialogs="true"></div>
	</div>
	<div class="center hideform">
	    <button id="close" style="float: right;">X</button>
	    <b>AADM Deployment</b><br>
	    Provide inputs for the AADM
	    <hr>
	    <form action="">
	        Deployment name:
	        <input type="text" name="deployment_name" value="">
	        <br>
	        Version tag (optional):
	        <input type="text" name="version_tag" value="">
	        <br>
	        <span>Number orchestrator workers (optional):
	        <input type="button" name="workersdecrease" value="-" onclick="decrease_worker()">
	        <input type="button" name="workersincrease" value="+" onclick="increase_worker()">
	        <input type="text" name="workers" value="1">
	        </span>
	        <br>
	        Select a image build configuration (optional):
	       	<input type="file" id="imagebuildfile" name="ibfilename">
	        <br>
	        Complete AADM (optional):
	        <input type="checkbox" name="workers" value="">
	        <br>
	        Select an inputs file:
	        <input type="file" id="inputsfile" name="inputsfilename">
	        <br>
	        <hr>
	        <b>Inputs:</b>
	        <div id="inputs">
	        </div>
	        <br>
	        <input type="submit" value="Deploy">
	    </form>
	</div>
</body>
</html>
